(()=>{"use strict";const e=function(e,n,t,i){const o=new XMLHttpRequest;o.open(e,n),o.addEventListener("load",(()=>{try{i(o.responseText)}catch(e){console.error(e)}})),o.addEventListener("error",(e=>{console.error("Erreur: "+e)})),o.send(t)};async function n(e,{username:n,icon:i},{custom_class:o="",animationDuration:a=1}={}){window.MESSAGE_ID+=1;const r=window.MESSAGE_ID,s=document.querySelector.bind(document),d=`\n        <div class='message_container ${n}_type ${o}'>            <div class="${n} message" id="message${r}">                ${"grandpy"===n?e:""}            </div>            <div class='profile_icon'>${i}</div>        </div>\n    `;return"grandpy"===n?(s("#dialogue_area").insertAdjacentHTML("beforeend",`<div class="loading ld ld-square ld-spin" id="animation${r}"></div>`),t(),await new Promise((e=>{setTimeout((()=>{s("#animation"+r).outerHTML=d,e()}),1e3*a)}))):(s("#dialogue_area").insertAdjacentHTML("beforeend",d),s("#message"+r).innerText=e),t(),Promise.resolve(r)}function t(){document.querySelector.bind(document)("#dialogue_area").lastElementChild.scrollIntoView(!0)}function i(){const e=["ðŸ‘©","ðŸ‘¤","ðŸ‘¨","ðŸ¥µ","ðŸ¥¶","ðŸ¤‘"];return e[Math.floor(Math.random()*e.length)]}function o(){const e=document.querySelector.bind(document),n=e("body").clientWidth<=970,i=n?120:220,o=n?50:60,a=e("#input_area").scrollHeight>i?i:e("#input_area").scrollHeight,r=parseInt(getComputedStyle(e("#input_container")).height,10);a>=i&&""!=e("#input_area").value&&r>=o+5||(e("#input_container").style.height=""!=e("#input_area").value?a+"px":"var(--input_container_height)",e("#dialogue_area").style.height=`calc(100% - ${e("#input_container").style.height})`,e("#dialogue_area").lastElementChild&&t())}function a(){const e=document.querySelector.bind(document),n=window.innerHeight>window.innerWidth?this.innerHeight+"px":e("html").clientHeight+"px";n!==e("body").style.height&&(e("body").style.height=n)}!function(){window.MESSAGE_ID=0,window.USER_LOCATION=null;const t={username:"user",icon:i()},r={username:"grandpy",icon:"ðŸ¤–"},s=document.querySelector.bind(document);let d=0;window.addEventListener("orientationchange",a),window.addEventListener("resize",a),window.addEventListener("load",(()=>{e("GET","/grandpy/starter/",null,(e=>{setTimeout((()=>n(e,r)),0)})),navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{window.USER_LOCATION={latitude:e.coords.latitude,longitude:e.coords.longitude}}),(e=>{window.USER_LOCATION=null,console.error(`Erreur code ${e.code}: ${e.message}`)})):window.USER_LOCATION=null})),s("#submit_button").addEventListener("click",(i=>{const a=s("#input_area").value;if(!a.trim())return i.preventDefault();const d=function(e){let n={};return/heure/gim.test(e)&&(n.timezone=(new Date).getTimezoneOffset()/-60),/temps/gim.test(e)&&(n.location=USER_LOCATION),JSON.stringify({user_message:e,options:n})}(a);n(a,t),e("POST","/grandpy/chat/",d,(e=>{const{answer:t,oc_anecdote:i,oc_coordinates:o}=JSON.parse(e);n(t,r),i&&o&&(async function(e,t,i=1){const o=document.querySelector.bind(document),a=e,r={animationDuration:i},s=await n('<div class="map"></div>',t,r);!function(){const e=new google.maps.Map(o(`#message${s} .map`),{center:a,zoom:19,gestureHandling:"cooperative"});new google.maps.Marker({position:a,map:e})}()}(o,r),setTimeout((()=>n(i,r)),4500))})),s("#input_area").value="",o(),i.preventDefault()})),s("#input_area").addEventListener("input",o),s("#input_area").addEventListener("keyup",(e=>{const n=e.code,t=!s("#input_area").value.trim();"Enter"===n&&(t||s("#submit_button").click())})),s("#brand_logo").addEventListener("click",(t=>{const i=JSON.stringify({reactions:"n"+d});e("POST","/grandpy/wtf/",i,(e=>n(e,r))),d++,t.preventDefault()}))}()})();